<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Ù…Ù†Ø¸ÙˆÙ…Ø© Ø§Ù„Ø£Ø±Ø´ÙØ© Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ©</title>
    <style>
        body {
            font-family: Tahoma, Arial, sans-serif;
            background-color: #f4f4f9;
            margin: 0;
            padding: 20px;
            text-align: right;
        }
        .container {
            max-width: 600px;
            margin: 40px auto;
            background: #fff;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }
        h2 {
            color: #2c3e50;
            border-bottom: 2px solid #2ecc71;
            padding-bottom: 10px;
            margin-bottom: 20px;
        }
        label {
            display: block;
            margin-top: 15px;
            font-weight: bold;
            color: #34495e;
        }
        input[type="text"], input[type="file"], select {
            width: 100%;
            padding: 10px;
            margin-top: 5px;
            border: 1px solid #ccc;
            border-radius: 6px;
            box-sizing: border-box;
        }
        button {
            background-color: #2ecc71;
            color: white;
            padding: 12px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            width: 100%;
            margin-top: 25px;
            font-size: 16px;
            transition: background-color 0.3s;
        }
        button:hover {
            background-color: #27ae60;
        }
        #message {
            margin-top: 20px;
            padding: 15px;
            border-radius: 6px;
            font-weight: bold;
            text-align: center;
            display: none;
        }
        .success { background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
    </style>
</head>
<body>

<div class="container">
    <h2>ğŸš€ Ø£Ø±Ø´ÙØ© Ù…Ù„Ù Ø¬Ø¯ÙŠØ¯</h2>
    <form id="archiveForm">

        <label for="category">Ø§Ø®ØªØ± ØªØµÙ†ÙŠÙ Ø§Ù„Ø£Ø±Ø´ÙŠÙ:</label>
        <select id="category" name="category" required>
            <option value="Uncategorized">ØºÙŠØ± Ù…ØµÙ†Ù</option>
            <option value="HR_Contracts">Ø¹Ù‚ÙˆØ¯ Ø§Ù„Ù…ÙˆØ§Ø±Ø¯ Ø§Ù„Ø¨Ø´Ø±ÙŠØ©</option>
            <option value="Finance_Invoices">ÙÙˆØ§ØªÙŠØ± ÙˆÙ…Ø§Ù„ÙŠØ©</option>
            <option value="Technical_Reports">ØªÙ‚Ø§Ø±ÙŠØ± ÙÙ†ÙŠØ©</option>
            <option value="Legal_Documents">ÙˆØ«Ø§Ø¦Ù‚ Ù‚Ø§Ù†ÙˆÙ†ÙŠØ©</option>
        </select>

        <label for="fileInput">Ø§Ø®ØªØ± Ø§Ù„Ù…Ù„Ù Ø§Ù„Ù…Ø±Ø§Ø¯ Ø£Ø±Ø´ÙØªÙ‡:</label>
        <input type="file" id="fileInput" name="file" required>

        <input type="hidden" id="computer_name" name="computer_name">
        <input type="hidden" id="user_name" name="user_name">

        <button type="submit" id="submitBtn">Ø£Ø±Ø´ÙØ© ÙˆØ¥Ø±Ø³Ø§Ù„</button>
    </form>

    <div id="message"></div>
</div>

<script>
    // â­ï¸ ÙŠØ¬Ø¨ ØªØ¹Ø¯ÙŠÙ„ Ù‡Ø°Ø§ Ø§Ù„Ù…ØªØºÙŠØ± Ù„ÙŠØªØ·Ø§Ø¨Ù‚ Ù…Ø¹ Ø¹Ù†ÙˆØ§Ù† IP Ù„Ø®Ø§Ø¯Ù… Flask API
    const API_URL = "http://192.168.100.30:5000/77";

    // Ù…Ø­Ø§ÙƒØ§Ø© Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¬Ù‡Ø§Ø² ÙˆØ§Ù„Ù…Ø³ØªØ®Ø¯Ù… (Ù…Ø­Ø¯ÙˆØ¯ÙŠØ© Ø§Ù„Ù…ØªØµÙØ­)
    // ÙÙŠ Ø¨ÙŠØ¦Ø© Ø¹Ù…Ù„ Ø­Ù‚ÙŠÙ‚ÙŠØ©ØŒ ÙŠØªÙ… ØªÙ…Ø±ÙŠØ± Ù‡Ø°Ù‡ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ø¨Ø± Ø³ÙƒØ±ÙŠØ¨Øª ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£Ùˆ Ø¢Ù„ÙŠØ§Ù‹.
    document.getElementById('computer_name').value = 'PC_WEB_' + Math.floor(Math.random() * 200);
    document.getElementById('user_name').value = 'User_' + Math.floor(Math.random() * 50);

    document.getElementById('archiveForm').addEventListener('submit', async function(e) {
        e.preventDefault();

        const fileInput = document.getElementById('fileInput');
        const category = document.getElementById('category').value;
        const submitBtn = document.getElementById('submitBtn');
        const messageDiv = document.getElementById('message');

        if (fileInput.files.length === 0) {
            alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù Ø£ÙˆÙ„Ø§Ù‹.');
            return;
        }

        const file = fileInput.files[0];

        // 1. Ø¨Ù†Ø§Ø¡ ÙƒØ§Ø¦Ù† FormData Ù„Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù…Ù„Ù ÙˆØ§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙˆØµÙÙŠØ©
        const formData = new FormData();
        formData.append('file', file);
        formData.append('computer_name', document.getElementById('computer_name').value);
        formData.append('user_name', document.getElementById('user_name').value);
        formData.append('category', category);

        submitBtn.disabled = true;
        submitBtn.textContent = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„...';
        messageDiv.style.display = 'none';

        try {
            // 2. Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ POST Ø¥Ù„Ù‰ Ø®Ø§Ø¯Ù… Flask API
            const response = await fetch(API_URL, {
                method: 'POST',
                body: formData
            });

            const result = await response.json();

            // 3. Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªÙŠØ¬Ø©
            messageDiv.style.display = 'block';
            if (response.ok && result.success) {
                messageDiv.className = 'success';
                messageDiv.innerHTML = `âœ… ØªÙ… Ø£Ø±Ø´ÙØ© Ø§Ù„Ù…Ù„Ù Ø¨Ù†Ø¬Ø§Ø­! Ø§Ø³Ù… Ø§Ù„Ù…Ù„Ù: <strong>${file.name}</strong>`;
                document.getElementById('archiveForm').reset();
            } else {
                messageDiv.className = 'error';
                messageDiv.innerHTML = `âŒ ÙØ´Ù„ Ø§Ù„Ø£Ø±Ø´ÙØ©. Ø®Ø·Ø£: ${result.error || 'Ø®Ø·Ø£ ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}`;
            }

        } catch (error) {
            messageDiv.style.display = 'block';
            messageDiv.className = 'error';
            messageDiv.innerHTML = `âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù… (ØªØ£ÙƒØ¯ Ù…Ù† Ø¹Ù†ÙˆØ§Ù† IP ÙˆØ§Ù„Ù…Ù†ÙØ°): ${error.message}`;
        } finally {
            submitBtn.disabled = false;
            submitBtn.textContent = 'Ø£Ø±Ø´ÙØ© ÙˆØ¥Ø±Ø³Ø§Ù„';
        }
    });
</script>

</body>
</html>
